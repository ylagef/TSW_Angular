<!-- <?= $this->Html->css('pollView') ?>
<?= $participatedOnPoll=false;?> -->
<!-- CENTRAL JUMBOTRON -->
<div class="jumbotron jumbotron-fluid rounded">
  <div class="container">
    <h1 class="display-4" i18n>
      View Poll
    </h1>
    <p class="lead"><i class="material-icons lead-icon">keyboard_arrow_right</i>
      {{poll.title}}
    </p>

    <div *ngIf="hasPlace; else noPlace">
      <p class="lead">
        <i class='material-icons lead-icon'>place</i>
        {{poll.place}}
      </p>
    </div>

    <ng-template #noPlace>
      <p class="lead" i18n>
        <i class='material-icons lead-icon'>place</i>
        - Location not specified -
      </p>
    </ng-template>

    <div class="input-group mb-3">
      <div class="input-group-prepend">
        <span class="input-group-text link-icon">
          <i class="material-icons">
            link
          </i>
        </span>
      </div>

      <input type="text" class="form-control poll-link" value="localhost/!!!{{poll.url}}" disabled id="copyValue">

      <div class="input-group-append">
        <button class="btn btn-outline-secondary" type="button" onclick="copy()" i18n>
          COPY
        </button>
      </div>
    </div>

    <div class="table-responsive">
      <table class="table text-center">
        <thead>
          <tr>
            <th scope="col" i18n>
              Gaps
            </th>

            <th scope="col" i18n *ngFor="let user of users">
              {{user.name}}
            </th>

            <th scope="col" class="font-weight-light" i18n *ngIf="gaps.length!=0">
              Total
            </th>
          </tr>
        </thead>
        <tbody>
          <!-- <?php 
            $maxGapCount=0;
            if($gaps->count()!=0){
              foreach ($gaps as $gap):
                $gapCount=0;
              ?> -->

          <tr id="TR{{gap.gap_id}}" *ngFor="let gap of gaps">
            <th scope="row">
              <p>
                {{gap.start_date}}
                <!-- <?= h($gap->start_date) ?> -->
              </p>
              <p>
                {{gap.end_date}}
                <!-- <?= h($gap->end_date) ?> -->
              </p>
            </th>

            <!-- <?php foreach ($users as $user): 
                  $isAssignated=false;
                  ?> -->
            <td *ngFor="let user of users">
              <!-- <?php 
                      foreach($assignations as $assignation):
                          if($assignation['user_id']==$user->user_id && $assignation['gap_id']==$gap->gap_id){
                              $isAssignated=true;
                              $gapCount++;
                          }

                          if($assignation['user_id']==$this->request->getSession()->read('Auth.User.user_id')){
                            $participatedOnPoll=true;
                        }
                      endforeach;

                      if($isAssignated){
                      ?> -->

              <button type="button" class="btn btn-success btn-sm btn-disabled" disabled *ngIf="assignationsMap.get(user.user_id)!=null && assignationsMap.get(user.user_id).indexOf(gap.gap_id)>-1 else notAssigned">
                <i class="material-icons">
                  done
                </i>
              </button>

              <ng-template #notAssigned>
                <button type="button" class="btn btn-outline-success btn-sm btn-disabled" disabled>

                  <i class="material-icons">
                    done
                  </i>
                </button>
              </ng-template>
            </td>
            <td>
              <a class="font-weight-light" id="count{{gap.gap_id}}">
                0
                <!-- <?php echo $gapCount?> -->
              </a>
            </td>
            <td>
              <a class="lead" i18n >
                Nobody has participated yet. Be the first!
              </a>
            </td>
            <!-- <?php  }?> -->
          </tr>
        </tbody>
      </table>

      <!-- <script>
        <?php foreach ($gaps as $gap):?>
        if (document.getElementById("count<?php echo $gap['gap_id'] ?>").innerHTML == "<?php echo $maxGapCount?>" &&
          document.getElementById("count<?php echo $gap['gap_id'] ?>").innerHTML != "0") {
          document.getElementById("TR<?php echo $gap['gap_id'] ?>").classList.add("table-success");
        }
        <?php endforeach; ?>
      </script> -->

      <hr class="my-3">

    </div>
  </div>

  <div class="other-option-button text-center">
    <!-- <?php if(!$participatedOnPoll){?>
    <a>
      <?= $this->Html->link(__('Participate'), ['controller'=>'assignations','action' => 'add', $poll->url],["class"=>"btn btn-outline-info"]) ?></a>
    <?php }else{ ?>
    <a>
      <?= $this->Html->link(__('Modify participation'), ['controller'=>'assignations','action' => 'edit', $poll->url],["class"=>"btn btn-outline-info"]) ?></a>
    <?php } ?>
    <?php if($this->request->getSession()->read('Auth.User.user_id')==$poll->author){ ?>
    <a>
      <?= $this->Html->link(__('Edit poll'), ['controller'=>'polls','action' => 'edit', $poll->url],["class"=>"btn btn-outline-info"]) ?></a>
    <?php } ?> -->
  </div>
</div>
